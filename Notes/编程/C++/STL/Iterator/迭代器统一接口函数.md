å…ˆçœ‹ï¼š[[Iterator Operations]]

---

# ä¸€ã€è¿™ç±»å‡½æ•°åœ¨æ ‡å‡†ä¸­çš„å®šä½

`advance / distance / next / prev` å¹¶ä¸æ˜¯â€œæ™®é€šå·¥å…·å‡½æ•°â€ï¼Œè€Œæ˜¯ï¼š

> **å¯¹â€œè¿­ä»£å™¨èƒ½åŠ›å·®å¼‚â€çš„ç»Ÿä¸€æŠ½è±¡æ¥å£**

å®ƒä»¬çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

- **æ¥å£ç»Ÿä¸€**
    
- **å®ç°æ ¹æ® iterator category è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜ç­–ç•¥**
    

è¿™æ­£æ˜¯ C++ è¿­ä»£å™¨è®¾è®¡çš„ç²¾åã€‚

---

# äºŒã€std::advance â€”â€” â€œè®©è¿­ä»£å™¨èµ° N æ­¥â€

## 1ï¸âƒ£ å‡½æ•°åŸå‹

```cpp
template<class InputIt, class Distance>
void advance(InputIt& it, Distance n);
```

ğŸ“Œ **æ³¨æ„**

- ä¼ å…¥çš„æ˜¯ **å¼•ç”¨**
    
- ä¼š **ç›´æ¥ä¿®æ”¹ it**
    
- ä¸è¿”å›å€¼
    

---

## 2ï¸âƒ£ ä¸åŒè¿­ä»£å™¨ä¸‹çš„çœŸå®è¡Œä¸ºï¼ˆæ ¸å¿ƒï¼‰

### ğŸ”¹ Input / Forward Iterator

```cpp
while (n-- > 0)
    ++it;
```

- åªèƒ½ `++`
    
- **çº¿æ€§æ—¶é—´ O(n)**
    
- n **å¿…é¡» â‰¥ 0**
    

ğŸ“Œ ä¾‹å­ï¼š

```cpp
forward_list<int> fl;
auto it = fl.begin();
advance(it, 10);   // åªèƒ½ä¸€ä¸ªä¸€ä¸ª ++
```

---

### ğŸ”¹ Bidirectional Iterator

```cpp
if (n >= 0)
    while (n--) ++it;
else
    while (n++) --it;
```

- æ”¯æŒè´Ÿæ•°
    
- ä»ç„¶æ˜¯ **O(|n|)**
    

ğŸ“Œ ä¾‹å­ï¼š

```cpp
list<int> lst;
advance(it, -3);   // åˆæ³•
```

---

### ğŸ”¹ Random Access Iteratorï¼ˆå…³é”®ä¼˜åŒ–ï¼‰

```cpp
it += n;
```

- **O(1)**
    
- è¿™å°±æ˜¯ `vector` å¿«çš„æ ¹æœ¬åŸå› 
    

ğŸ“Œ ä¾‹å­ï¼š

```cpp
vector<int> v;
auto it = v.begin();
advance(it, 1'000'000); // å¸¸æ•°æ—¶é—´
```

---

## 3ï¸âƒ£ å…¸å‹å‘ç‚¹

### âŒ å¯¹ Input Iterator ä½¿ç”¨è´Ÿæ•°

```cpp
istream_iterator<int> it;
advance(it, -1);   // âŒ æœªå®šä¹‰è¡Œä¸º
```

---

### âŒ è¯¯ä»¥ä¸º advance æœ‰è¿”å›å€¼

```cpp
auto it2 = advance(it, 5); // âŒ
```

---

## 4ï¸âƒ£ ä»€ä¹ˆæ—¶å€™å¿…é¡»ç”¨ advanceï¼Ÿ

- å†™ **æ¨¡æ¿ç®—æ³•**
    
- ä¸çŸ¥é“è¿­ä»£å™¨ç±»å‹
    
- æƒ³è·å¾—â€œæœ€ä¼˜å¤æ‚åº¦â€
    

---

# ä¸‰ã€std::distance â€”â€” â€œä¸¤ä¸ªè¿­ä»£å™¨ä¹‹é—´æœ‰å¤šè¿œâ€

## 1ï¸âƒ£ å‡½æ•°åŸå‹

```cpp
template<class InputIt>
typename iterator_traits<InputIt>::difference_type
distance(InputIt first, InputIt last);
```

ğŸ“Œ **é‡è¦**

- ä¸ä¿®æ”¹å‚æ•°
    
- è¿”å›å€¼ç±»å‹æ˜¯ `difference_type`
    

---

## 2ï¸âƒ£ ä¸åŒè¿­ä»£å™¨ä¸‹çš„å®ç°å·®å¼‚

### ğŸ”¹ Input / Forward / Bidirectional

```cpp
difference_type n = 0;
while (first != last) {
    ++first;
    ++n;
}
return n;
```

- **O(n)**
    
- å¿…é¡»ä¸€æ­¥æ­¥èµ°
    

ğŸ“Œ å®¹å™¨ï¼š

- `list`
    
- `forward_list`
    
- `set / map`
    

---

### ğŸ”¹ Random Access Iteratorï¼ˆå…³é”®ï¼‰

```cpp
return last - first;
```

- **O(1)**
    

ğŸ“Œ å®¹å™¨ï¼š

- `vector`
    
- `deque`
    
- `array`
    

---

## 3ï¸âƒ£ éå¸¸é‡è¦çš„è¯­ä¹‰é™åˆ¶

### âš ï¸ distance å¯¹ Input Iterator æ˜¯â€œæ¶ˆè€—æ€§â€çš„

```cpp
istream_iterator<int> a, b;
auto n = distance(a, b); // a è¢«èµ°åˆ° b
```

ğŸ“Œ **è¿™æ˜¯æ ‡å‡†å…è®¸çš„**

ğŸ‘‰ Input Iterator åªä¿è¯ä¸€æ¬¡éå†

---

## 4ï¸âƒ£ å¸¸è§è¯¯è§£

### âŒ ä»¥ä¸º list::size() å’Œ distance ä¸€æ ·å¿«

```cpp
distance(lst.begin(), lst.end()); // O(n)
lst.size();                       // C++11 èµ·æ˜¯ O(1)
```

---

# å››ã€std::next / std::prev â€”â€” advance çš„å®‰å…¨å°è£…

## 1ï¸âƒ£ std::next

```cpp
template<class It>
It next(It it, difference_type n = 1);
```

ç­‰ä»·äºï¼š

```cpp
It tmp = it;
advance(tmp, n);
return tmp;
```

ğŸ“Œ **ä¸ä¿®æ”¹åŸè¿­ä»£å™¨**

---

## 2ï¸âƒ£ std::prev

```cpp
template<class It>
It prev(It it, difference_type n = 1);
```

ğŸ“Œ **è¦æ±‚ Bidirectional ä»¥ä¸Š**

---

### ä½¿ç”¨ç¤ºä¾‹

```cpp
auto it2 = next(it, 5);   // å®‰å…¨
auto it1 = prev(it, 2);   // å¿…é¡»æ”¯æŒ --
```

---

# äº”ã€advance / distance ä¸ç®—æ³•æ€§èƒ½çš„å†³å®šæ€§å…³ç³»

## ä¾‹å­ 1ï¼šä¸ºä»€ä¹ˆ sort ä¸èƒ½ç”¨äº listï¼Ÿ

```cpp
sort(lst.begin(), lst.end()); // âŒ
```

åŸå› ï¼š

- `sort` å†…éƒ¨å¤§é‡ä½¿ç”¨ï¼š
    
    - `it + n`
        
    - `it2 - it1`
        
- éœ€è¦ **Random Access Iterator**
    

---

## ä¾‹å­ 2ï¼šä¸ºä»€ä¹ˆ nth_element å¾ˆå¿«ï¼Ÿ
ï¼ˆnth_elementç”¨äºæŸ¥æ‰¾ç¬¬kå¤§/å°çš„å…ƒç´ ï¼‰
```cpp
nth_element(v.begin(), v.begin() + k, v.end());
```

ğŸ“Œ ä¾èµ–ï¼š

- O(1) çš„ `advance`
    
- O(1) çš„ `distance`
    

---

# å…­ã€iterator_traitsï¼šè¿™ä¸€åˆ‡çš„å¹•åé»‘æ‰‹

```cpp
iterator_traits<It>::iterator_category
```

æ ‡å‡†å†…éƒ¨åšçš„äº‹æƒ…å¤§è‡´æ˜¯ï¼š

```cpp
if constexpr (is_random_access_iterator<It>)
    it += n;//Random Access Iterator
else
    while (n--) ++it;//else
```
traitä¼šè‡ªåŠ¨è¯†åˆ«è¿­ä»£å™¨ç±»å‹å¹¶æ‰¾åˆ°å¯¹åº”å‡½æ•°æ¥å£

ğŸ‘‰ **advance / distance æ˜¯ traits + tag dispatch çš„ç»å…¸åº”ç”¨**

---

# ä¸ƒã€ç»ˆæå¯¹ç…§è¡¨ï¼ˆæ ¸å¿ƒè®°å¿†ï¼‰

|å‡½æ•°|Input|Forward|Bidirectional|Random Access|
|---|---|---|---|---|
|advance(it, +n)|âœ”|âœ”|âœ”|âœ” (O1)|
|advance(it, -n)|âœ˜|âœ˜|âœ”|âœ”|
|distance|O(n)|O(n)|O(n)|O(1)|
|next|âœ”|âœ”|âœ”|âœ”|
|prev|âœ˜|âœ˜|âœ”|âœ”|

---

# å…«ã€ä¸€å¥è¯æ€»ç»“ï¼ˆé«˜çº§ç†è§£ï¼‰

> **advance / distance å¹¶ä¸æ˜¯â€œå¸®ä½ å†™å¾ªç¯â€**  
> **è€Œæ˜¯ï¼šè®©ç®—æ³•â€œåœ¨ä¸çŸ¥é“è¿­ä»£å™¨ç±»å‹çš„æƒ…å†µä¸‹ä»ç„¶åšåˆ°æœ€ä¼˜å¤æ‚åº¦â€**



[[ç»Ÿä¸€æ¥å£åŸç†æ€»ç»“]]
