**errno 变量**

 - 这是一个全局整数变量，用于存储最近一次发生的错误代码
 - 只有当函数执行失败时，`errno` 才会被设置，成功执行时不会被清零

`errno.h` 里的错误编号（其实是**宏定义**，可以理解为 “预先起好名字的数字”），就像给各种错误原因贴了标签。比如 “文件找不到” 对应一个标签，“权限不够” 对应另一个标签。这些标签在不同系统（比如 Linux、Windows）里的数字可能不一样，但名字是通用的，所以编程时只用名字不用数字。

下面按 “常见场景” 分类，讲一些最常用的错误编号：

### 一、文件 / 目录操作相关错误

这些错误最常出现在 `fopen`（打开文件）、`mkdir`（创建目录）、`remove`（删除文件）等操作中。

1. **ENOENT**
    
    - 含义：**文件或目录不存在**（“No such file or directory”）
    - 例子：当你用 `fopen("abc.txt", "r")` 打开一个根本不存在的 `abc.txt` 时，`errno` 就会被设为 `ENOENT`。
2. **EEXIST**
    
    - 含义：**文件或目录已存在**（“File exists”）
    - 例子：当你用 `mkdir("test", 0777)` 创建一个名叫 `test` 的目录，但这个目录早就有了，就会触发 `EEXIST`。
3. **EISDIR**
    
    - 含义：**操作的对象是目录（但你以为是文件）**（“Is a directory”）
    - 例子：你想打开一个文件读写，结果路径填成了一个目录（比如 `fopen("/home/user", "w")`），就会触发这个错误。
4. **ENOTDIR**
    
    - 含义：**操作的对象不是目录（但你以为是目录）**（“Not a directory”）
    - 例子：你想进入一个目录（`chdir` 函数），但路径其实是一个文件（比如 `chdir("abc.txt")`），就会触发这个错误。
5. **EACCES**
    
    - 含义：**权限不够**（“Permission denied”）
    - 例子：你想修改一个 “只读” 文件（比如 `fopen("/root/test.txt", "w")`，但你不是管理员），就会触发这个错误。
6. **EBUSY**
    
    - 含义：**资源正忙**（“Device or resource busy”）
    - 例子：你想删除一个正在被使用的文件（比如一个正在播放的视频文件），或者卸载一个正在被访问的磁盘分区，就可能触发这个错误。

### 二、内存相关错误

主要出现在动态内存分配（比如 `malloc`、`calloc`）时。

1. **ENOMEM**
    - 含义：**内存不足**（“Not enough memory”）
    - 例子：当你用 `malloc(1024 * 1024 * 1024)` 申请 1GB 内存，但系统已经没有这么多空闲内存时，`malloc` 会返回 `NULL`，同时 `errno` 被设为 `ENOMEM`。

### 三、参数 / 输入错误

当函数收到不合法的参数时会触发。

1. **EINVAL**
    
    - 含义：**无效的参数**（“Invalid argument”）
    - 例子：
        - 给 `sleep` 函数传一个负数（`sleep(-5)`），因为睡眠时间不能为负；
        - 调用 `strtol`（字符串转整数）时，传入的基数（比如 37）超过了 2-36 的范围。
2. **ERANGE**
    
    - 含义：**结果超出范围**（“Result too large”）
    - 例子：用 `strtol` 把一个超大的字符串（比如 `"1234567890123456789012345"`）转成整数，超出了 `long` 类型的最大值，就会触发 `ERANGE`。

### 四、其他常见错误

1. **EPERM**
    
    - 含义：**操作不允许**（“Operation not permitted”）
    - 比 `EACCES` 更严重，通常是 “权限完全没有”，比如普通用户尝试执行只有 root 才能做的操作（比如修改系统时间）。
2. **EIO**
    
    - 含义：**输入 / 输出错误**（“Input/output error”）
    - 通常是硬件问题，比如读取 U 盘时 U 盘突然拔掉，或者硬盘坏道导致读写出错。
3. **ENFILE**
    
    - 含义：**系统打开的文件太多**（“Too many open files in system”）
    - 整个系统打开的文件数量超过了上限（一般很少遇到，除非恶意打开大量文件）。
4. **EMFILE**
    
    - 含义：**当前进程打开的文件太多**（“Too many open files”）
    - 单个程序打开的文件数量超过了系统限制（比如循环调用 `fopen` 却不 `fclose`，打开几百个文件后就会触发）。

### 关键注意点：

1. 这些编号的**具体数字不重要**（比如 Linux 里 `ENOENT` 是 2，Windows 里可能不同），编程时只用宏名（比如 `if (errno == ENOENT)`）。
2. 只有函数**明确失败**时，`errno` 才有意义（成功时 `errno` 可能不变，也可能乱设，别信）。
3. 可以用 `strerror(errno)` 或者 `perror` 把编号转成人类能看懂的文字（比如把 `ENOENT` 转成 “没有那个文件或目录”）